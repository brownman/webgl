<script>
<%content_for :global do %>
  var heightMap;

  function updateKeyboardInput()
  {
    var rotation = [0,0,0];
    var translation = [0,0,0];
    var movement_speed = 1.5; // in GL units per second
    var rotation_speed = 0.5;
    var strafing_speed = 1.0;
      
    movement_speed *= 0.75; // because that's the delay between frames (via setInterval, above)
    rotation_speed *= 0.15; // in an offline app we'd calculate time elapsed between frames.
    strafing_speed *= 0.15;
      
    if (currentlyPressedKeys[37]) rotation[1] -= rotation_speed; // arrow left
    if (currentlyPressedKeys[39]) rotation[1] += rotation_speed; // arrow right
    if (currentlyPressedKeys[38]) rotation[0] += rotation_speed; // arrow up
    if (currentlyPressedKeys[40]) rotation[0] -= rotation_speed; // arrow down
    if (currentlyPressedKeys[87]) translation[2] -= 1; // W
    if (currentlyPressedKeys[83]) translation[2] += 1; // S
    if (currentlyPressedKeys[65]) translation[0] -= 1; // A
    if (currentlyPressedKeys[68]) translation[0] += 1; // D
      
    world.camera.move(movement_speed, translation);
    //camera.rotateView(rotation[0], rotation[1], 0);
  }
<%end%>

<%content_for :init do%>
  var img = new Image();
  img.onload = function() {
    heightMap = new HeightMap(img, {magnitude:4});
    world.addObject(heightMap);
    context.checkError();
    heightMap.addTexture(new Texture("/images/textures/poormansgrass.png"), {scale:3});
    context.checkError();
  };
  img.src = "/images/height.png";

  world.camera.moveTo(35, 75, 42);
  world.camera.orient([0, -1, -0.2], [0, 0.2, -1]).look();
      
  setInterval(updateKeyboardInput, 30);
<%end%>

<%content_for :render do%>
  world.render();
<%end%>
</script>
