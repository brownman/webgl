<script>
  <%content_for :global do%>
    var world = new World();
    var teapot = null;
    var texture = null;
  <%end%>
          
  <%content_for :init do%>
    JSON3D.load("/3d/teapot.json", function(obj) { teapot = obj; });

    var img = new Image();
    img.onload = function() {
      texture = gl.createTexture();
      gl.bindTexture(gl.TEXTURE_2D, texture);  
      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);  
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);  
      gl.generateMipmap(gl.TEXTURE_2D);  
      gl.bindTexture(gl.TEXTURE_2D, null);
    };
    img.src = "/images/textures/poormansgrass.png";  

    world.camera.translateTo(0,0,50);
  <%end%>
          
  <%content_for :render do%>
    if (teapot) {
      if (texture && $('use-texture').checked) {
        teapot.texture = texture;
        teapot.shader = shaders['color_with_texture'];
      }
      else teapot.shader = shaders['color_without_texture'];
      
      world.camera.look(gl);
      teapot.render();
    }
  <%end%>
</script>

<%content_for :head do%>
  <style>#canvas { float: left; }</style>
<%end%>

<input type='checkbox' id='use-texture' /> Use Texture